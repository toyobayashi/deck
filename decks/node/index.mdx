import { CodeSurfer, CodeSurferColumns } from "code-surfer"
import customTheme from './theme.js'
import "prismjs/components/prism-java"

export const theme = customTheme

# 在 Android 应用中嵌入 Node.js

Press arrow key to start

---

# 重定向输出流到 Logcat

---

<CodeSurfer>

```cpp file=./logcat/1.cpp

```

```cpp file=./logcat/2.cpp

```

```cpp file=./logcat/3.cpp

```

```cpp file=./logcat/4.cpp

```

```diff

```

</CodeSurfer>

---

# Node.js 进程初始化与销毁清理

---

<CodeSurferColumns sizes={[1,1,2]}>

<Step subtitle="JNI">

```java file=./init/1-1.java

```

```cpp file=./init/1-2.cpp

```

```cpp file=./init/1-3.cpp

```

</Step>

<Step subtitle="JNI">

```java file=./init/2-1.java

```

```cpp file=./init/2-2.cpp

```

```cpp file=./init/2-3.cpp

```

</Step>

<Step subtitle="用假的全局命令行参数初始化 libuv、node、v8">

```java 6:7 file=./init/3-1.java

```

```cpp 3:5,7:8 file=./init/3-2.cpp

```

```cpp file=./init/3-3.cpp

```

</Step>

<Step subtitle="在 Application 生命周期中初始化">

```java 6 file=./init/3-1.java

```

```cpp 7 file=./init/3-2.cpp

```

```java 5 file=./init/4-3.java

```

</Step>

<Step>

```diff

```

```diff

```

```diff

```

</Step>

</CodeSurferColumns>

---

# Node.js 实例环境

---

<CodeSurferColumns sizes={[3,4]}>

<Step subtitle="不可拷贝不可移动">

```cpp file=./env/1-1.cpp

```

```cpp file=./env/1-2.cpp

```

</Step>

<Step subtitle="使用 PIMPL 分离实现">

```cpp file=./env/2-1.cpp

```

```cpp file=./env/2-2.cpp

```

</Step>

<Step subtitle="私有构造函数中初始化 libuv 循环，创建 v8 Isolate 和 v8 Context，绑定一个 Node Environment">

```cpp file=./env/3-1.cpp

```

```cpp file=./env/3-2.cpp

```

</Step>

<Step subtitle="析构函数中释放资源，确保 libuv 循环没任务了才关闭循环">

```cpp file=./env/4-1.cpp

```

```cpp file=./env/4-2.cpp

```

</Step>

<Step subtitle="公有 Getters">

```cpp file=./env/5-1.cpp

```

```cpp file=./env/5-2.cpp

```

</Step>

<Step subtitle="工厂函数，把 node::CreateEnvironment 传给构造函数">

```cpp file=./env/6-1.cpp

```

```cpp file=./env/6-2.cpp

```

</Step>

<Step>

```diff

```

```diff

```

</Step>

</CodeSurferColumns>

---

# Node.js 实例对象

---

<CodeSurferColumns sizes={[3,4]}>

<Step>

```cpp file=./init/3-2.cpp

```

```cpp file=./init/3-3.cpp

```

</Step>

<Step>

```cpp file=./instance/2-1.cpp

```

```cpp file=./instance/2-2.cpp

```

</Step>

<Step>

```cpp file=./instance/3-1.cpp

```

```cpp file=./instance/3-2.cpp

```

</Step>

<Step>

```cpp file=./instance/4-1.cpp

```

```cpp file=./instance/4-2.cpp

```

</Step>

<Step>

```cpp file=./instance/5-1.cpp

```

```cpp file=./instance/5-2.cpp

```

</Step>

<Step>

```cpp 17:20,36:40 file=./instance/6-1.cpp

```

```cpp file=./instance/6-2.cpp

```

</Step>

<Step>

```cpp 13:18,24:29,45:49 file=./instance/7-1.cpp

```

```cpp file=./instance/7-2.cpp

```

</Step>

<Step>

```cpp 24:29 file=./instance/8-1.cpp

```

```cpp file=./instance/8-2.cpp

```

</Step>

<Step>

```cpp file=./instance/9-1.cpp

```

```cpp file=./instance/9-2.cpp

```

</Step>

<Step>

```cpp file=./instance/10-1.cpp

```

```cpp file=./instance/10-2.cpp

```

</Step>

<Step>

```diff

```

```diff

```

</Step>

</CodeSurferColumns>

---

# Linked Binding

---

<CodeSurferColumns>

<Step>

```cpp 124,169 file=./instance/10-2.cpp

```

```cpp file=./binding/1-2.cpp

```

</Step>

<Step>

```cpp 124,169 file=./instance/10-2.cpp

```

```cpp file=./binding/2-2.cpp

```

</Step>

<Step>

```cpp 124,169 file=./instance/10-2.cpp

```

```cpp file=./binding/3-2.cpp

```

</Step>

<Step>

```cpp 124,169 file=./instance/10-2.cpp

```

```cpp file=./binding/4-2.cpp

```

</Step>

<Step>

```cpp 124,169 file=./instance/10-2.cpp

```

```cpp file=./binding/5-2.cpp

```

</Step>

<Step>

```diff

```

```diff

```

</Step>

</CodeSurferColumns>

---

# JNI

---

<CodeSurferColumns>

<Step>

```cpp file=./jni/1-1.java

```

```cpp file=./jni/1-2.cpp

```

</Step>

<Step>

```cpp file=./jni/2-1.java

```

```cpp file=./jni/2-2.cpp

```

</Step>

<Step>

```cpp file=./jni/3-1.java

```

```cpp file=./jni/3-2.cpp

```

</Step>

<Step>

```cpp file=./jni/4-1.java

```

```cpp file=./jni/4-2.cpp

```

</Step>

<Step>

```cpp file=./jni/5-1.java

```

```cpp file=./jni/5-2.cpp

```

</Step>

<Step>

```cpp file=./jni/6-1.java

```

```cpp file=./jni/6-2.cpp

```

</Step>

<Step>

```cpp file=./jni/7-1.java

```

```cpp file=./jni/7-2.cpp

```

</Step>

<Step>

```cpp file=./jni/8-1.java

```

```cpp file=./jni/8-2.cpp

```

</Step>

<Step>

```cpp file=./jni/9-1.java

```

```cpp file=./jni/9-2.cpp

```

</Step>

<Step>

```diff

```

```diff

```

</Step>

</CodeSurferColumns>

---

# Repository

[https://gitee.com/toyobayashi/NodeExample](https://gitee.com/toyobayashi/NodeExample)
